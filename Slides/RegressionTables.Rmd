---
title: "18: Preparing Regression Tables."
subtitle: "Linear Models"
author: "<large>Jaye Seawright</large>"
institute: "<small>Northwestern Political Science</small>" 
date: "March 9, 2026"
output: 
  xaringan::moon_reader:
    css: xaringan-themer.css
  
---
class: center, middle


```{css, echo=FALSE}
pre {
  max-height: 400px;
  overflow-y: auto;
}

pre[class] {
  max-height: 200px;
}
```

```{r, load_refs, include=FALSE, cache=FALSE}
# Initializes
library(RefManageR)

library(ggplot2)
library(dplyr)
library(readr)
library(nlme)
library(jtools)
library(mice)
library(knitr)
library(modelsummary)
library(kableExtra)
library(stringr)
library(ggplot2)
library(dplyr)
library(sandwich)
library(lmtest)
library(clubSandwich)
library(fixest)
library(modelsummary)
library(AER)

BibOptions(check.entries = FALSE,
           bib.style = "authoryear", # Bibliography style
           max.names = 3, # Max author names displayed in bibliography
           sorting = "nyt", #Name, year, title sorting
           cite.style = "authoryear", # citation style
           style = "markdown",
           hyperlink = FALSE,
           dashed = FALSE)

library(rqog)
qogts <- read_qog(which_data="standard", data_type = "time-series")

```
```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer,MnSymbol)
style_mono_accent(
  base_color = "#1c5253",
  header_font_google = google_font("Josefin Sans"),
  text_font_google   = google_font("Montserrat", "300", "300i"),
  code_font_google   = google_font("Fira Mono"),
  text_font_size = "1.6rem"
)

knitr::opts_chunk$set(warning = FALSE, message = FALSE)

```

# Why Professional Tables Matter

### **Communication Goals**
1. **Clarity:** Readers should understand your findings
2. **Reproducibility:** Others should be able to replicate
3. **Efficiency:** One table can convey what paragraphs cannot

---

### **Political Science Standards**
- **Top journals** (APSR, AJPS, JOP) have specific formatting
- **Replication archives** require clean code
- **Policy audiences** need accessible presentation
- **Your own workflow** benefits from organization

---

### **Common Problems in Student Work**
```{r bad-table, eval=FALSE}
# What NOT to do
> summary(model)

Call:
lm(formula = y ~ x1 + x2)

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept)  1.23456    0.09876  12.345  < 2e-16 ***
x1           0.56789    0.12345   4.567 5.67e-06 ***
x2          -0.34567    0.23456  -1.234    0.218    

R-squared:  0.3456
Adj R-squared: 0.3345
```

---
# The R Ecosystem for Tables

### **Main Packages**
1. **`modelsummary`** 
   - Modern, flexible, actively maintained
   - Works with many model types
   - Excellent documentation

2. **`stargazer`** (legacy but still used)
   - Long history in political science
   - Simple syntax
   - Some limitations with new models

---

3\. **`gtsummary`** (medical/social science focus)
   - Beautiful default formatting
   - Great for clinical/epidemiological papers
   - Less common in political science

4\. **`kableExtra`** (manual control)
   - Complete customization
   - Steeper learning curve
   - For when others fail
---

### **Choosing the Right Tool**
```{r tool-choice, echo=FALSE}
tools <- data.frame(
  Use_Case = c("General political science",
               "Quick tables for drafts",
               "Medical/clinical style",
               "Complete customization",
               "Teaching/learning"),
  Primary_Tool = c("modelsummary", "stargazer", 
                   "gtsummary", "kableExtra", "any"),
  Key_Feature = c("Flexibility", "Simplicity", 
                  "Pretty defaults", "Total control", "Clarity")
)

knitr::kable(tools, 
             caption = "Which Tool When?") %>%
  kableExtra::kable_styling(full_width = FALSE)
```

---

### **Our Focus Today:**
**`modelsummary`** - the modern standard 


---
# Package 1: `modelsummary`

### **Key Advantages**
1. **Inclusive:** Works with 100+ model types
2. **Flexible output:** HTML, LaTeX, Word, PDF, Markdown
3. **Customizable:** Every aspect can be modified

---

### **Basic Syntax**
```{r modelsummary-basic, eval=FALSE}
library(modelsummary)

# Single model
model <- lm(y ~ x1 + x2, data = df)
msummary(model)

# Multiple models
models <- list("Model 1" = mod1, 
               "Model 2" = mod2)
msummary(models)

# With robust SEs
msummary(models, vcov = "HC3")
```

---

### **Worked Example**
```{r modelsummary-example, eval=TRUE}
# Load data
data("Mroz", package = "carData")
Mroz$lfp <- 1*(Mroz$lfp=="yes")

# Estimate models
model1 <- lm(lfp ~ k5 + k618 + age + wc + hc, 
             data = Mroz)
model2 <- lm(lfp ~ k5 + k618 + age + wc + hc + lwg, 
             data = Mroz)
model3 <- lm(lfp ~ k5 + k618 + age + wc + hc + lwg + inc, 
             data = Mroz)

# Create table
models <- list("(1)" = model1, 
               "(2)" = model2, 
               "(3)" = model3)

we.ms <- msummary(models,
         stars = TRUE,
         gof_omit = "AIC|BIC|Log|Adj", 
         output = "kableExtra") %>%
  kable_styling(font_size = 10)
```
---

```{r show-worked-example, eval=TRUE, echo=FALSE}
we.ms
```

---
# Customizing `modelsummary` Output

### **1. Variable Labels**
```{r coef-map, eval=TRUE}
cm <- c('k5' = 'Children < 6',
        'k618' = 'Children 6-18',
        'age' = 'Age',
        'wc' = 'Wife college',
        'hc' = 'Husband college',
        'lwg' = 'Log wage rate',
        'inc' = 'Family income')

vl.ms <- msummary(models, 
         coef_map = cm,
         stars = TRUE, 
         output = "kableExtra") %>%
  kable_styling(font_size = 10)
```
---

```{r show-vls, eval=TRUE, echo=FALSE}
vl.ms
```

---
### **2. Statistics Selection**
```{r gof-omit, eval=TRUE}
ss.ms <- msummary(models,
         gof_omit = 'AIC|BIC|Log|RMSE',
         gof_map = list(
           list("raw" = "nobs", "clean" = "N", "fmt" = 0),
           list("raw" = "r.squared", "clean" = "RÂ²", "fmt" = 3)
         ), 
         output = "kableExtra") %>%
  kable_styling(font_size = 10)
```
---

```{r show-ss, eval=TRUE, echo=FALSE}
ss.ms
```

---
### **3. Standard Errors**
```{r vcov-types, eval=TRUE}
# Robust SEs
se.ms <- msummary(models, vcov = "HC3", 
         output = "kableExtra") %>%
  kable_styling(font_size = 10)

```

---

```{r show-se, eval=TRUE, echo=FALSE}
se.ms
```

---
### **4. Formatting**
```{r formatting, eval=TRUE}
# Decimal places
msummary(models, fmt = 2, 
         output = "kableExtra") %>%
  kable_styling(font_size = 10)
```

---
```{r formatting-2, eval=TRUE}
# Different formats for estimates and SEs
msummary(models,
         fmt = fmt_statistic(estimate = 3, 
                             std.error = 2), 
         output = "kableExtra") %>%
  kable_styling(font_size = 10)
```

---
```{r formatting-3, eval=TRUE}
# Confidence intervals instead of SEs
msummary(models,
         statistic = "conf.int",
         conf_level = 0.95, 
         output = "kableExtra") %>%
  kable_styling(font_size = 10)
```

---

```{r formatting-4, eval=TRUE}
# Add title and notes
msummary(models,
         title = "Table 1: Labor Force Participation",
         notes = c("Data: Mroz (1987)", 
                   "Robust standard errors in parentheses",
                   "*p<0.1, **p<0.05, ***p<0.01"), 
         output = "kableExtra") %>%
  kable_styling(font_size = 10)
```

---
# Advanced `modelsummary` Features

### **1. Model Comparison**
```{r model-comparison, eval=FALSE}
# Compare different model types
library(fixest)
library(lme4)

models <- list(
  "OLS" = lm(y ~ x, data = df),
  "Fixed Effects" = feols(y ~ x | state, data = df),
  "Random Effects" = lmer(y ~ x + (1|state), data = df)
)

msummary(models,
         stars = TRUE,
         output = "table.html")
```

---

### **2. Output Formats**
```{r output-formats, eval=FALSE}
# Save to different formats
msummary(models, output = "table.tex")    # LaTeX
msummary(models, output = "table.docx")   # Word
msummary(models, output = "table.html")   # HTML
msummary(models, output = "table.md")     # Markdown
msummary(models, output = "table.txt")    # Plain text
msummary(models, output = "gt")           # gt object
```

---

### **3. Custom Tidiers**
```{r custom-tidiers, eval=FALSE}
# For unsupported models
custom_tidy <- function(model) {
  # Extract coefficients
  coefs <- coef(summary(model))
  data.frame(
    term = rownames(coefs),
    estimate = coefs[, 1],
    std.error = coefs[, 2],
    statistic = coefs[, 3],
    p.value = coefs[, 4]
  )
}

msummary(model, 
         tidy = custom_tidy)
```

---

### **4. Theme System**
```{r themes, eval=FALSE}
# Set global defaults
modelsummary::modelsummary_settings(
  fmt_decimal = 3,
  stars = c('*' = 0.1, '**' = 0.05, '***' = 0.01),
  estimate = "{estimate} ({std.error})",
  statistic = NULL
)

# Now all tables use these settings
msummary(models)
```

---
# Package 2: `stargazer` - The Legacy Workhorse

### **Still Common in Political Science**
- Used in many published papers
- Simple syntax for basic tables

---

### **Basic Usage**
```{r stargazer-basic, eval=TRUE}
library(stargazer)

# Single model
stargazer(model1, type = "text")
```

---

```{r stargazer-basic-2, eval=TRUE}
# Multiple models
stargazer(list(model1, model2, model3),
          type = "text",
          title = "Regression Results",
          align = TRUE)
```

---

```{r stargazer-basic-3, eval=TRUE, results='asis'}
# Better
stargazer(model1, model2, model3,
          type = "html",
          dep.var.labels = "Dependent Variable",
          covariate.labels = c("Var1", "Var2", "Var3"))
```

---

### **Strengths and Weaknesses**
```{r stargazer-procon, echo=FALSE}
procon <- data.frame(
  Strength = c("Simple syntax",
               "Widely used/recognized",
               "Good HTML output for Word",
               "Handles many model types",
               "Good for teaching"),
  Weakness = c("Limited customization",
               "Less active development",
               "Can be buggy with new models",
               "LaTeX-focused originally",
               "Verbose syntax for complex tables")
)

knitr::kable(procon, 
             caption = "Stargazer: Pros and Cons") %>%
  kableExtra::kable_styling(full_width = FALSE)
```

---
# Package 3: `gtsummary` 

### **Medical/Social Science Focus**
- Designed for clinical research
- Beautiful automatic formatting
- Great for descriptive statistics too

---

### **Basic Regression Tables**
```{r gtsummary-basic, eval=TRUE}
library(gtsummary)

tbl_regression(model1, exponentiate = FALSE)

```

---

### **Strengths**
1. **Automatic formatting** of categorical variables
2. **Clean defaults** with minimal code
3. **Good descriptive statistics** tables
4. **Medical journal style** if that's your target

---

### **Limitations**
1. **Less common** in political science
2. **Focus on medical models** (survival, etc.)
3. **Less flexible** for complex model comparisons
4. **Different syntax** from other packages

---
# Package 4: `kableExtra` - Complete Control

### **When You Need Total Control**
- Customize every aspect
- Combine multiple tables
- Complex formatting needs

---

### **Basic Workflow**
```{r kable-basic, eval=FALSE}
library(kableExtra)

# Start with kable()
table <- model %>%
  broom::tidy() %>%
  kable(format = "html",
        digits = 3,
        col.names = c("Variable", "Coefficient", 
                      "SE", "t-stat", "p-value")) %>%
  kable_styling(bootstrap_options = "striped",
                full_width = FALSE) %>%
  add_header_above(c(" " = 1, "Estimate" = 4)) %>%
  footnote(general = "Standard errors in parentheses")

# Save
save_kable(table, "table.html")
```

---

### **Advantages**
1. **Total control** over formatting
2. **Combine** models, summary stats, etc.
3. **Advanced features:** grouping, coloring, etc.
4. **Works with any data frame**

---
# Table Design Principles

### **1. Clarity First**
- **Clear variable names** (not R variable names)
- **Consistent formatting** across tables
- **Adequate white space**
- **Logical ordering** of variables/models

---

### **2. Information Hierarchy**
```{r hierarchy, echo=FALSE, fig.height=3}
importance <- data.frame(
  Element = c("Coefficients/SEs",
              "Model fit statistics",
              "Variable labels",
              "Significance stars",
              "Table notes",
              "Decorative formatting"),
  Importance = c(10, 10, 10, 4, 6, 3)
)

ggplot(importance, aes(x = reorder(Element, Importance), 
                       y = Importance)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  labs(x = NULL, y = "Importance (1-10)",
       title = "Table Elements by Importance") +
  theme_minimal()
```

---

### **3. Social Science Practices**
- **Report robust/clustered SEs** 
- **Include $R^2$ and $N$** (always)
- **Consistent decimal places** 
- **p-values, maybe also stars** (check journal rules)

### **4. Accessibility**
```{r accessibility, eval=FALSE}
# Good practices:
# 1. Avoid color-only coding
# 2. Provide alternative text if images
# 3. Use clear, sans-serif fonts
# 4. Ensure sufficient contrast
# 5. Provide machine-readable versions

# In modelsummary:
msummary(models,
         notes = c("Note: Standard errors in parentheses",
                   "Data available upon request"),
         title = "Table 1: Main Results")
```

---
###Example

[This One's For the Boys](https://www.cambridge.org/core/journals/american-political-science-review/article/this-ones-for-the-boys-how-gendered-political-socialization-limits-girls-political-ambition-and-interest/FC49F85EDDAAA804DCBFBA63C6C437F0)
