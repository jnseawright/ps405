<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>17: Robust Standard Errors.</title>
    <meta charset="utf-8" />
    <meta name="author" content="Jaye Seawright" />
    <meta name="date" content="2026-03-04" />
    <script src="RobustStandardErrors_files/header-attrs-2.30/header-attrs.js"></script>
    <script src="RobustStandardErrors_files/kePrint-0.0.1/kePrint.js"></script>
    <link href="RobustStandardErrors_files/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# 17: Robust Standard Errors.
]
.subtitle[
## Linear Models
]
.author[
### <large>Jaye Seawright</large>
]
.institute[
### <small>Northwestern Political Science</small>
]
.date[
### March 4, 2026
]

---

class: center, middle


&lt;style type="text/css"&gt;
pre {
  max-height: 400px;
  overflow-y: auto;
}

pre[class] {
  max-height: 200px;
}
&lt;/style&gt;




### The Problem: Why We Need Robust SEs

---

### **Classical OLS Assumption:**
$$
\text{Var}(\epsilon_i | X) = \sigma^2
$$
Constant variance (homoskedasticity)

---

### **Reality:**
- Some groups are more predictable than others
- Richer districts have more variation in outcomes
- Survey error varies by respondent type
- Time-series volatility changes over time

**This is heteroskedasticity**

---

![](RobustStandardErrors_files/figure-html/hetero-example-1.png)&lt;!-- --&gt;

---

**Consequence:** Standard errors are wrong → confidence intervals wrong → p-values wrong

---
### **What Happens?**

1. **OLS coefficients remain unbiased**
2. **But variance estimates are biased:**
   - Can be too small (common) → false significance
   - Can be too large → missed findings

---
### **Examples from Political Science:**
- **Wealth and voting:** Richer districts show different patterns of variation in turnout than poor districts (e.g., Avery 2015)
- **Media effects:** Highly attentive individuals are differently predictable compared to less attentive people (e.g., Walgrave et al., 2017)
- **Policy adoption:** Effects may differ across space and time (e.g. Matisoff 2008)
- **Conflict studies:** Actors have different distributions of information, motivations, and resources (e.g., Bas 2012)

---


```
## Average SE (homoskedastic): 0.101
```

```
## Average SE (heteroskedastic): 0.143
```

```
## 
## Typical underestimation: -29 %
```

---

![](RobustStandardErrors_files/figure-html/consequence-plot-1.png)&lt;!-- --&gt;

---
### **Huber-White (Sandwich) Estimator**
Developed by Huber (1967) and White (1980)

**Regular OLS variance:**
$$
\text{Var}(\hat{\beta}) = (X'X)^{-1} \sigma^2
$$

**Robust (HC) variance:**
$$
\text{Var}(\hat{\beta}) = (X'X)^{-1} X' \Omega X (X'X)^{-1}
$$
where `\(\Omega = \text{diag}(e_i^2)\)` for HC0

---
### **Intuition:**
- Weight observations by their residual size
- Bigger residuals → more uncertainty in that region
- Adapts to heteroskedasticity

---
### **Flavors of HC Estimators**
<div id="luuznfetdr" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#luuznfetdr table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#luuznfetdr thead, #luuznfetdr tbody, #luuznfetdr tfoot, #luuznfetdr tr, #luuznfetdr td, #luuznfetdr th {
  border-style: none;
}

#luuznfetdr p {
  margin: 0;
  padding: 0;
}

#luuznfetdr .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#luuznfetdr .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#luuznfetdr .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#luuznfetdr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#luuznfetdr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#luuznfetdr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#luuznfetdr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#luuznfetdr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#luuznfetdr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#luuznfetdr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#luuznfetdr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#luuznfetdr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#luuznfetdr .gt_spanner_row {
  border-bottom-style: hidden;
}

#luuznfetdr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#luuznfetdr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#luuznfetdr .gt_from_md > :first-child {
  margin-top: 0;
}

#luuznfetdr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#luuznfetdr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#luuznfetdr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#luuznfetdr .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#luuznfetdr .gt_row_group_first td {
  border-top-width: 2px;
}

#luuznfetdr .gt_row_group_first th {
  border-top-width: 2px;
}

#luuznfetdr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#luuznfetdr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#luuznfetdr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#luuznfetdr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#luuznfetdr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#luuznfetdr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#luuznfetdr .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#luuznfetdr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#luuznfetdr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#luuznfetdr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#luuznfetdr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#luuznfetdr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#luuznfetdr .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#luuznfetdr .gt_left {
  text-align: left;
}

#luuznfetdr .gt_center {
  text-align: center;
}

#luuznfetdr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#luuznfetdr .gt_font_normal {
  font-weight: normal;
}

#luuznfetdr .gt_font_bold {
  font-weight: bold;
}

#luuznfetdr .gt_font_italic {
  font-style: italic;
}

#luuznfetdr .gt_super {
  font-size: 65%;
}

#luuznfetdr .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#luuznfetdr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#luuznfetdr .gt_indent_1 {
  text-indent: 5px;
}

#luuznfetdr .gt_indent_2 {
  text-indent: 10px;
}

#luuznfetdr .gt_indent_3 {
  text-indent: 15px;
}

#luuznfetdr .gt_indent_4 {
  text-indent: 20px;
}

#luuznfetdr .gt_indent_5 {
  text-indent: 25px;
}

#luuznfetdr .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#luuznfetdr div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_heading">
      <td colspan="3" class="gt_heading gt_title gt_font_normal gt_bottom_border" style>Common HC Estimators</td>
    </tr>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Type">Type</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Formula">Weight</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Description">Description</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="Type" class="gt_row gt_left" style="font-size: 16px;">HC0</td>
<td headers="Formula" class="gt_row gt_left" style="font-size: 16px;">\(e_i^2\)</td>
<td headers="Description" class="gt_row gt_left" style="font-size: 16px;">Basic White</td></tr>
    <tr><td headers="Type" class="gt_row gt_left" style="font-size: 16px;">HC1</td>
<td headers="Formula" class="gt_row gt_left" style="font-size: 16px;">\(\frac{n}{n-k}e_i^2\)</td>
<td headers="Description" class="gt_row gt_left" style="font-size: 16px;">Incomplete small sample correction</td></tr>
    <tr><td headers="Type" class="gt_row gt_left" style="font-size: 16px;">HC2</td>
<td headers="Formula" class="gt_row gt_left" style="font-size: 16px;">\(\frac{e_i^2}{1-h_{ii}}\)</td>
<td headers="Description" class="gt_row gt_left" style="font-size: 16px;">Leverage adjustment</td></tr>
    <tr><td headers="Type" class="gt_row gt_left" style="font-size: 16px;">HC3</td>
<td headers="Formula" class="gt_row gt_left" style="font-size: 16px;">\(\frac{e_i^2}{(1-h_{ii})^2}\)</td>
<td headers="Description" class="gt_row gt_left" style="font-size: 16px;">Better small sample correction</td></tr>
    <tr><td headers="Type" class="gt_row gt_left" style="font-size: 16px;">HC4</td>
<td headers="Formula" class="gt_row gt_left" style="font-size: 16px;">\(\frac{e_i^2}{(1-h_{ii})^{\delta_i}}\)</td>
<td headers="Description" class="gt_row gt_left" style="font-size: 16px;">Designed for outliers</td></tr>
  </tbody>
  
</table>
</div>

---
### **Social Science Practice:**
- **HC1**, **HC2**, and **HC3** converge for larger samples (above about 500)
- **HC3** performs best for smaller samples and works well down to samples of about 25 
- **Stata default:** HC1, in spite of its limitations
- **R common practice:** HC3, which is probably the best choice (Long and Ervin 2000)
]

---
### Implementation in R: The `sandwich` Package

---
### **Basic Implementation**


``` r
library(sandwich)
library(lmtest)

la_electoral &lt;- read.csv("https://raw.githubusercontent.com/jnseawright/ps405/refs/heads/main/Data/laelectoral.csv")

# After fitting model
# Fit regular model
model &lt;- lm(voteswoninc ~ gdpgrowthlag + votesinclag, data = la_electoral)
```

---


``` r
# Regular SEs
summary(model)
```

```
## 
## Call:
## lm(formula = voteswoninc ~ gdpgrowthlag + votesinclag, data = la_electoral)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -49.632  -9.563   6.100  13.505  29.843 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)   -3.3713    12.0876  -0.279  0.78099   
## gdpgrowthlag   1.0473     0.4600   2.277  0.02528 * 
## votesinclag    0.7166     0.2361   3.036  0.00318 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 19.01 on 86 degrees of freedom
## Multiple R-squared:  0.1439,	Adjusted R-squared:  0.124 
## F-statistic:  7.23 on 2 and 86 DF,  p-value: 0.001252
```
---
  

``` r
# Robust SEs (HC3 default)
coeftest(model, vcov = vcovHC)
```

```
## 
## t test of coefficients:
## 
##              Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)  -3.37130   12.54174 -0.2688 0.788722   
## gdpgrowthlag  1.04729    0.44261  2.3661 0.020221 * 
## votesinclag   0.71660    0.25701  2.7882 0.006523 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

---


``` r
# Different HC types
coeftest(model, vcov = vcovHC(model, type = "HC0"))
```

```
## 
## t test of coefficients:
## 
##              Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)  -3.37130   11.67991 -0.2886 0.773551   
## gdpgrowthlag  1.04729    0.40190  2.6058 0.010800 * 
## votesinclag   0.71660    0.24007  2.9850 0.003692 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

---
  

``` r
coeftest(model, vcov = vcovHC(model, type = "HC1"))
```

```
## 
## t test of coefficients:
## 
##              Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)  -3.37130   11.88188 -0.2837 0.777296   
## gdpgrowthlag  1.04729    0.40885  2.5615 0.012165 * 
## votesinclag   0.71660    0.24422  2.9342 0.004286 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

---
  

``` r
coeftest(model, vcov = vcovHC(model, type = "HC3"))
```

```
## 
## t test of coefficients:
## 
##              Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)  -3.37130   12.54174 -0.2688 0.788722   
## gdpgrowthlag  1.04729    0.44261  2.3661 0.020221 * 
## votesinclag   0.71660    0.25701  2.7882 0.006523 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

---
### **Using `modelsummary`**

``` r
library(modelsummary)

ms.display &lt;- modelsummary(
  list("OLS" = model, 
       "Robust SE" = model),
  vcov = list("iid", "HC3"),
  stars = TRUE, output = "kableExtra"
)
```

---

&lt;table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; OLS &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Robust SE &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −3.371 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −3.371 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (12.088) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (12.542) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; gdpgrowthlag &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.047* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.047* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.460) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.443) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; votesinclag &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.717** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.717** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.236) &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.257) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 89 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 89 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.144 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.144 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 Adj. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.124 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.124 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; AIC &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 781.7 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 781.7 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; BIC &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 791.7 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 791.7 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Log.Lik. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −386.874 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −386.874 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; F &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 7.230 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 7.018 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; RMSE &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 18.69 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 18.69 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Std.Errors &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; IID &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; HC3 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; + p &amp;lt; 0.1, * p &amp;lt; 0.05, ** p &amp;lt; 0.01, *** p &amp;lt; 0.001&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;

---
### **Complete Example**

``` r
# Load data
data("CASchools", package = "AER")
# Simulate heteroskedasticity
CASchools$testscore &lt;- 
  CASchools$read + CASchools$math + 
  rnorm(nrow(CASchools), 0, 
        abs(CASchools$income)/1000)

# Fit model
model &lt;- lm(testscore ~ income + english, 
            data = CASchools)

# Compare SEs
library(modelsummary)
models &lt;- list(
  "Regular" = model,
  "HC0" = model,
  "HC1" = model,
  "HC2" = model,
  "HC3" = model
)

caschools.msummary &lt;- msummary(models,
         vcov = c("iid", "HC0", "HC1", "HC2", "HC3"),
         fmt = 2,
         stars = TRUE,
         output = "kableExtra") %&gt;%
  kable_styling(font_size = 10)
```

---

&lt;table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto; font-size: 10px; margin-left: auto; margin-right: auto;" class="table table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Regular &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; HC0 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; HC1 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; &amp;amp;nbsp;HC2 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; &amp;amp;nbsp;HC3 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1277.85*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1277.85*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1277.85*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1277.85*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1277.85*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (2.86) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (3.41) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (3.42) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (3.46) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (3.52) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; income &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.00*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.00*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.00*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.00*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.00*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.15) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.18) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.18) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.19) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.19) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; english &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.98*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.98*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.98*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.98*** &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.98*** &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1.5px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.06) &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.06) &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.06) &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.06) &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1.5px"&gt; (0.06) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 420 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 420 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 420 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 420 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 420 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.707 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.707 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.707 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.707 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.707 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 Adj. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.706 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.706 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.706 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.706 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.706 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; AIC &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3741.1 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3741.1 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3741.1 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3741.1 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3741.1 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; BIC &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3757.2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3757.2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3757.2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3757.2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3757.2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Log.Lik. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −1866.540 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −1866.540 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −1866.540 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −1866.540 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −1866.540 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; F &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 503.396 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 445.674 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 442.491 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 432.888 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 420.409 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; RMSE &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 20.60 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 20.60 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 20.60 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 20.60 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 20.60 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Std.Errors &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; IID &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; HC0 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; HC1 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; HC2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; HC3 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; + p &amp;lt; 0.1, * p &amp;lt; 0.05, ** p &amp;lt; 0.01, *** p &amp;lt; 0.001&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;

---

### **Key Insight:**
Robust SEs often (but not always) increase standard errors, making findings **less significant**. This is more honest given real-world data.

---
# Clustered Standard Errors

### **When Observations Are Not Independent**
Common in political science:
1. **Panel data:** Multiple observations per country
2. **Survey data:** Respondents within states
3. **Experimental data:** Treatments assigned to groups
4. **Spatial data:** Nearby locations correlated

---
### **The Problem:**
Within-cluster correlation → underestimation of variance

**Example:** If all respondents in Texas share unobserved factors, we don't have 100 independent observations, but 1 cluster of 100 correlated observations

---
### **Clustering Formula**
$$
\text{Var}(\hat{\beta}) = (X'X)^{-1} \left( \sum_{c=1}^C X_c' e_c e_c' X_c \right) (X'X)^{-1}
$$
where `\(c\)` indexes clusters

---
### **Implementation in R:**

``` r
# Using sandwich and lmtest
coeftest(model, 
         vcov = vcovCL(model, 
                       cluster = ~state))

# Using fixest package (fast!)
library(fixest)
model_fe &lt;- feols(vote_share ~ income + education,
                  data = election_data,
                  cluster = ~state)

# Using clubSandwich for multi-way clustering
library(clubSandwich)
coef_test(model, 
          vcov = "CR2", 
          cluster = election_data$state)
```

---
# Multi-Way Clustering

### **Complex Dependencies**
Sometimes observations cluster in multiple ways:
1. **States and years** (Cameron, Gelbach &amp; Miller, 2011)
2. **Individual and time** (two-way FE)
3. **Industry and region**

---

### **R Implementation:**

``` r
# Using clubSandwich
vcov_multi &lt;- vcovCR(model,
                     type = "CR2",
                     cluster = election_data[, c("state", "year")])

coeftest(model, vcov = vcov_multi)

# Using lfe (older but works)
library(lfe)
model_multi &lt;- felm(vote_share ~ income + education |
                      state + year,
                    data = election_data)
summary(model_multi, robust = TRUE)
```

---
### **When to Cluster?**

&lt;table class="table" style="font-size: 10px; margin-left: auto; margin-right: auto;"&gt;
&lt;caption style="font-size: initial !important;"&gt;Clustering Guidelines for Political Data&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Data_Structure &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Clustering &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; R_Package &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Cross-section &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; No clustering or heteroskedasticity-robust &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; sandwich &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Panel (country-year) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Cluster by country &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; plm/sandwich &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Survey (individuals in states) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Cluster by state (or primary sampling unit) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; survey/sandwich &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Experimental (treatments in groups) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Cluster by treatment group &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; clubSandwich &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Time series &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Newey-West (HAC) errors &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; sandwich &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Network/spatial &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Spatial HAC or Conley errors &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; spatialreg &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

**Rule of thumb:** Cluster at the level of treatment assignment or at the level where you suspect correlation.

---
# Limitations and When NOT to Use Robust SEs

### **1. Very Small Samples**
- HC estimators biased in tiny samples
- N &lt; 25: Consider alternatives
- Better: Use exact methods or permutation tests

### **2. Weighted Data**
- Survey weights already account for heterogeneity
- Don't double-adjust

---

### **3. Nonlinear Models**
- GLMs (logit, probit) have different variance structure

### **4. Model Misspecification**
Robust SEs don't fix:
- Omitted variable bias
- Functional form misspecification
- Measurement error
- Simultaneity

---

### **5. Efficiency Loss**
- Robust SEs are less efficient when homoskedasticity holds

Use robust SEs unless you have strong reason not to

---

![Robust1](Images/Xu1.png)

---

![Robust2](Images/Xu2.png)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create();
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
